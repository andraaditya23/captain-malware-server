import os
import yara
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

def send_email(subject, message, to_addr):
    from_addr = "your_email@gmail.com"
    password = "your_password"

    msg = MIMEMultipart()
    msg['From'] = from_addr
    msg['To'] = to_addr
    msg['Subject'] = subject

    msg.attach(MIMEText(message, 'plain'))

    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.starttls()
    server.login(from_addr, password)
    server.send_message(msg)
    server.quit()

def scan_file(filepath, rules):
    matches = rules.match(filepath)

    if matches:
        print("ALERT: Malware detected!")
        send_email("ALERT: Malware detected!", f"Malware detected in file {filepath}.", "adam@gmail.com")
    else:
        print("No malware detected.")

# Define a directory with your rule files
rule_dir = "/path/to/yara/rules"

# Create a dictionary with your rule names and file paths
rule_dict = {f: os.path.join(rule_dir, f) for f in os.listdir(rule_dir) if f.endswith('.yar')}

# Compile all rules
rules = yara.compile(filepaths=rule_dict)

# Scan the file
scan_file('/path/to/your/file', rules)